<html>
  <head>
    <title>Socket.IO chat</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <link rel="stylesheet" href="css/style.css">
  </head>
  <body>
    <label for="message" class="h4" style="margin-top: 20px;">Message:</label>
    <button id="refresh" class="btn">Clear</button>
    <div style=" overflow-y: scroll; overflow-x: hidden;max-height: 25rem; "id ="box">
    <ul id="messages" style="  list-style: none;width: 1650px; height:auto;"></ul>
  <div  style=" position: fixed; width:200px; height: 0px; top: 50%; left: 50%; margin-left: 590px; margin-top: -300px; max-height: 200px;">
    <b>Member in the room</b>
    <div id="users"></div>
  </div>
</div>
<div>
    <form>
      TO<select  id="id" class="form-control"></select  id="id">
      <input id="m" class="form-control" rows="5" placeholder="Enter your message" required></input><br>
      <button type="submit" id="form-submit" class="btn btn-secondary">Send</button>
      <button id="leave" class="btn btn-secondary" >Leave Room</button>
      <h3 id="room">Room: </h3>
    </form>
  </div>
    <script>
        var clientname;
        var socket=io.connect();
        $(function(){
        socket.on('connect',function(){
          num=Math.floor(Math.random() * 100000)
          var name,roomid;
          if(!(name=prompt('What\'s yours name ?','Guest '+num)))
          name="Guest "+num;
          if(!(roomid=prompt('Which room do you want to join ?')))
          roomid="Guest";
          clientname=name;
          socket.emit('NewUser',name,socket.id,roomid);
          $('#room').append(roomid);
        })
        //Clearchat
        $('#refresh').click(function(e){
          $('#messages').empty();
          e.preventDefault();
        })
        //LeaveRoom
        $('#leave').click(function(e){
          if(!(roomid=prompt('Which room do you want to join ?')))
          roomid="Guest";
          socket.emit('leave-room',roomid);
          e.preventDefault();
          $('#room').empty().append('Room: '+roomid);
        })
        //Notify A member joined chatroom
        socket.on('notify',function(username){
          $('#messages').append('<li><b>'+username+'</b></li>');
          $('#box').scrollTop($('#box').height());
        })
        //Submit Member information
        $(function(){
        $('#form-submit').click(function(e){
          if($('#m').val()!=''){
          var message=$('#m').val();
          $('#m').val('');
          e.preventDefault();
          if($('#id').val()!='Chatroom'){
            socket.emit('private',message,$('#id').val());
          }
          else
          socket.emit('sendmes',message);
        }
        })
        $('#m').keypress(function(e){
          if(e.which==13){
            if($('#m').val()!=''){
            var message=$('#m').val();
            $('#m').val('');
            e.preventDefault();
            console.log($('#id').val())
            if($('#id').val()!='Chatroom'){
            socket.emit('private',message,$('#id').val());
            }
            else{
            socket.emit('sendmes',message);
            $(this).blur();
            }
          }
        }
        })
      });
        //Send messages to chatroom
        socket.on('post',function(name,data){
          $('#messages').append('<div><b  class="text-light bg-dark">'+name+'</b>:<br>'+data);
          $('#box').stop ().animate ({scrollTop: $('#box')[0].scrollHeight});
          $('#m').focus();
        })
        //Update Private message destination
        socket.on('select',function(list){
          $('#id').empty();
          $('#id').append('<option>Chatroom</option>');
          $.each(list,function(user){
            if(user!='null'&&user!=clientname)
            $('#id').append('<option>'+user+'</option>');
          })
        })
        //update online Member
        socket.on('update',function(list){
          $('#users').empty();
          $.each(list,function(user){
            if(user!='null')
            $('#users').append('<div>'+user+'</div>');
          })
        })
        //Detect a Member left the room
        socket.on('leave',function(data){
          $('#messages').append('<li><b>'+data+'</b></li>');
          $('#box').stop ().animate ({scrollTop: $('#box')[0].scrollHeight});
        })
      })
    </script>
  </body >
</html>